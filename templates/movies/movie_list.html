{% extends "base.html" %}

{% block content %}

<div class="container mt-4">

    <h2 class="mb-4">Фильтр фильмов</h2>

    <form method="GET" class="card p-3 mb-4 shadow-sm">

        <div class="row g-3 align-items-end">

            
            <div class="col-md-4">
                <label class="form-label">Поиск</label>
                <input type="text"
                       name="search"
                       value="{{ search_value }}"
                       class="form-control"
                       placeholder="Поиск фильма...">
            </div>

            
            <div class="col-md-3">
                <label class="form-label">Год</label>
                <select name="year_choice" class="form-select">
                    <option value="">Все годы</option>
                    <option value="2026" {% if selected_year == "2026" %}selected{% endif %}>2026</option>
                    <option value="2025" {% if selected_year == "2025" %}selected{% endif %}>2025</option>
                    <option value="2024" {% if selected_year == "2024" %}selected{% endif %}>2024</option>
                    <option value="2020_2023" {% if selected_year == "2020_2023" %}selected{% endif %}>2020-2023</option>
                </select>
            </div>

            
            <div class="col-md-3">
                <label class="form-label">Жанр</label>
                <select name="genre_id" class="form-select">
                    <option value="">Все жанры</option>

                    {% for genre in genres %}
                    <option value="{{ genre.id }}"
                        {% if genre.id|stringformat:"s" in selected_genres %}selected{% endif %}>
                        {{ genre.name }}
                    </option>
                    {% endfor %}

                </select>
            </div>

            
            <div class="col-md-2">
                <button class="btn btn-primary w-100">
                    Найти
                </button>
            </div>

        </div>
    </form>


    <h2 class="mb-4">Список фильмов</h2>

    <div class="row">

        {% for movie in movies %}

        <div class="col-md-3 mb-4">
            <div class="card h-100 shadow-sm">

                {% if movie.image %}
                    <img src="{{ movie.image.url }}" class="card-img-top" style="height:350px; object-fit:cover;">
                {% else %}
                    <img src="/media/movies/empty.png" class="card-img-top" style="height:350px; object-fit:cover;">
                {% endif %}

                <div class="card-body d-flex flex-column">

                    <h5 class="card-title">{{ movie.title }}</h5>

                    <p class="text-muted mb-3">Год: {{ movie.year }}</p>

                    <a href="/movies/{{ movie.id }}/" class="btn btn-outline-primary mt-auto">
                        Подробнее
                    </a>
                  
                    <a href="/movie_delete/{{ movie.id }}/"
                        class="btn btn-danger mt-2">
                        Удалить
                    </a>
                    

                </div>
            </div>
        </div>

        {% empty %}

        <div class="col-12">
            <div class="alert alert-warning">
                Фильмы не найдены
            </div>
        </div>

        {% endfor %}

    </div>
    <div class="d-flex justify-content-center mt-5">
    <nav>
        <ul class="pagination">

            {% for page in list_pages %}

                <li class="page-item">
                    <a class="page-link"
                       href="?page={{ page }}{% if search_value %}&search={{ search_value }}{% endif %}{% if selected_year %}&year_choice={{ selected_year }}{% endif %}">
                        {{ page }}
                    </a>
                </li>

            {% endfor %}

        </ul>
    </nav>
</div>

</div>

{% endblock %}